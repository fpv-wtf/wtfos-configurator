!function(){"use strict";var t={40906:function(t,e,r){var n,s=r(93433),i=r(1413),a=r(15861),u=r(15671),c=r(43144),o=r(87757),h=r.n(o),f=r(60136),p=r(29388),d=r(7112);!function(t){var e;!function(t){t[t.COMPLETE=0]="COMPLETE",t[t.ERROR=1]="ERROR",t[t.PROGRESS_INIT=2]="PROGRESS_INIT",t[t.PROGRESS_UPDATE=3]="PROGRESS_UPDATE",t[t.START=4]="START"}(e||(e={})),t.MessageType=e;var r=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(t){var n;return(0,u.Z)(this,r),(n=e.call(this,t)).name="DecoderError",n}return(0,c.Z)(r)}((0,d.Z)(Error));t.DecoderError=r;var n=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(t){var n;return(0,u.Z)(this,r),(n=e.call(this,t)).name="DecoderConfigureError",n}return(0,c.Z)(r)}(r);t.DecoderConfigureError=n;var s=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(t){var n;return(0,u.Z)(this,r),(n=e.call(this,t)).name="EncoderError",n}return(0,c.Z)(r)}((0,d.Z)(Error));t.EncoderError=s;var i=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(t){var n;return(0,u.Z)(this,r),(n=e.call(this,t)).name="EncoderConfigureError",n}return(0,c.Z)(r)}(s);t.EncoderConfigureError=i}(n||(n={}));var x=n,l=r(29439),v=r(37762),m=r(57676),y=function(){function t(e){(0,u.Z)(this,t),this.file=void 0,this.buffer=new ArrayBuffer(0),this.bufferOffset=0,this._offset=0,this.file=e}return(0,c.Z)(t,[{key:"getNextString",value:function(){var t=(0,a.Z)(h().mark((function t(e){var r,n,s,i,a;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=6;break}return t.next=3,this.getNextBytes(e);case 3:r=t.sent,t.next=15;break;case 6:n=[];case 7:return t.next=9,this.getNextUint8();case 9:if(t.t0=s=t.sent,0===t.t0){t.next=14;break}n.push(s),t.next=7;break;case 14:r=new Uint8Array(n);case 15:return i=new TextDecoder,a=i.decode(r),t.abrupt("return",a);case 18:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getNextUint8",value:function(){var t=(0,a.Z)(h().mark((function t(){var e;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getDataView(1);case 2:return e=t.sent,t.abrupt("return",e.getUint8(0));case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getNextUint16",value:function(){var t=(0,a.Z)(h().mark((function t(){var e;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getDataView(2);case 2:return e=t.sent,t.abrupt("return",e.getUint16(0));case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getNextUint32",value:function(){var t=(0,a.Z)(h().mark((function t(){var e;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getDataView(4);case 2:return e=t.sent,t.abrupt("return",e.getUint32(0));case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getNextUint64",value:function(){var t=(0,a.Z)(h().mark((function t(){var e;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getDataView(8);case 2:return e=t.sent,t.abrupt("return",e.getBigUint64(0));case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getNextBytes",value:function(){var t=(0,a.Z)(h().mark((function t(e){var r,n,s;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getDataView(e);case 2:for(r=t.sent,n=new Uint8Array(e),s=0;s<e;s++)n[s]=r.getUint8(s);return t.abrupt("return",n);case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"seek",value:function(t){this._offset=t,(this._offset<this.bufferOffset||this._offset>this.bufferEndOffset)&&(this.buffer=new ArrayBuffer(0),this.bufferOffset=this._offset)}},{key:"skip",value:function(t){this._offset+=t}},{key:"eof",get:function(){return this.offset>=this.file.size}},{key:"offset",get:function(){return this._offset}},{key:"size",get:function(){return this.file.size}},{key:"fillBuffer",value:function(){var e=(0,a.Z)(h().mark((function e(r){var n,s,i;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((n=this.offset+r)>this.bufferEndOffset)){e.next=8;break}return s=Math.floor(this.offset/t.BUFFER_SIZE)*t.BUFFER_SIZE,i=Math.ceil(n/t.BUFFER_SIZE)*t.BUFFER_SIZE,e.next=6,this.file.slice(s,i).arrayBuffer();case 6:this.buffer=e.sent,this.bufferOffset=s;case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDataView",value:function(){var t=(0,a.Z)(h().mark((function t(e){var r;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.fillBuffer(e);case 2:return r=new DataView(this.buffer,this.offset-this.bufferOffset,e),this._offset+=e,t.abrupt("return",r);case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"bufferEndOffset",get:function(){return this.bufferOffset+this.buffer.byteLength}}]),t}();y.BUFFER_SIZE=8388608;var w=function(){function t(e){(0,u.Z)(this,t),this.file=void 0,this.stream=void 0,this.buffer=void 0,this.uint8Buffer=void 0,this.uint16Buffer=void 0,this.uint32Buffer=void 0,this.uint64Buffer=void 0,this.uint16View=void 0,this.uint32View=void 0,this.uint64View=void 0,this._offset=0,this._size=0,this.file=e,this.buffer=new ArrayBuffer(8),this.uint8Buffer=new Uint8Array(this.buffer,0,1),this.uint16Buffer=new Uint16Array(this.buffer,0,1),this.uint32Buffer=new Uint32Array(this.buffer,0,1),this.uint64Buffer=new BigUint64Array(this.buffer,0,1),this.uint16View=new DataView(this.buffer,0,2),this.uint32View=new DataView(this.buffer,0,4),this.uint64View=new DataView(this.buffer,0,8)}return(0,c.Z)(t,[{key:"writeNextUint8",value:function(){var t=(0,a.Z)(h().mark((function t(e){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.uint8Buffer[0]=e,t.next=3,this.writeNextBytes(this.uint8Buffer);case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"writeNextUint16",value:function(){var t=(0,a.Z)(h().mark((function t(e){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.uint16View.setUint16(0,e,!1),t.next=3,this.writeNextBytes(this.uint16Buffer);case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"writeNextUint32",value:function(){var t=(0,a.Z)(h().mark((function t(e){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.uint32View.setUint32(0,e,!1),t.next=3,this.writeNextBytes(this.uint32Buffer);case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"writeNextUint64",value:function(){var t=(0,a.Z)(h().mark((function t(e){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"number"===typeof e&&(e=BigInt(e)),this.uint64View.setBigUint64(0,e,!1),t.next=4,this.writeNextBytes(this.uint64Buffer);case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"writeNextString",value:function(){var t=(0,a.Z)(h().mark((function t(e,r){var n;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new Uint8Array(void 0!==r?r:e.length+1),(new TextEncoder).encodeInto(e,n),t.next=5,this.writeNextBytes(n);case 5:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()},{key:"writeNextBytes",value:function(){var t=(0,a.Z)(h().mark((function t(e){var r,n;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getStream();case 2:return r=t.sent,t.next=5,r.write(e);case 5:n=e instanceof Blob?e.size:e.byteLength,this._offset+=n,this._size+=n;case 8:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"skip",value:function(){var t=(0,a.Z)(h().mark((function t(e){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.seek(this.offset+e);case 2:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"seek",value:function(){var t=(0,a.Z)(h().mark((function t(e){var r;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getStream();case 2:return r=t.sent,t.next=5,r.seek(e);case 5:this._offset=e;case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"close",value:function(){var t=(0,a.Z)(h().mark((function t(){var e;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getStream();case 2:return e=t.sent,t.next=5,e.close();case 5:this.stream=void 0;case 6:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getStream",value:function(){var t=(0,a.Z)(h().mark((function t(){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.stream){t.next=8;break}return t.next=3,this.file.createWritable();case 3:return this.stream=t.sent,t.next=6,this.stream.truncate(0);case 6:this._size=0,this._offset=0;case 8:return t.abrupt("return",this.stream);case 9:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"offset",get:function(){return this._offset}},{key:"size",get:function(){return this._size}}]),t}();function k(t){void 0===t&&(t=new Date);var e=new Date("1904-01-01T00:00:00Z");return Math.floor((t.getTime()-e.getTime())/1e3)}function g(t){return Z.apply(this,arguments)}function Z(){return(Z=(0,a.Z)(h().mark((function t(e){var r,n,s,i,a;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.offset,t.next=3,e.getNextUint32();case 3:return n=t.sent,t.next=6,e.getNextString(4);case 6:if(s=t.sent,0!==n){t.next=12;break}n=e.size-r,console.debug("".concat(s," box has size 0, must continue until end of file: ").concat(n)),t.next=19;break;case 12:if(1!==n){t.next=19;break}return t.t0=Number,t.next=16,e.getNextUint64();case 16:t.t1=t.sent,n=(0,t.t0)(t.t1),console.debug("".concat(s," box has big size: ").concat(n));case 19:return(i={"url ":Y,"urn ":X,avc1:z,avcC:H,co64:_,dinf:J,dref:Q,ftyp:B,hdlr:W,mdat:C,mdhd:M,mdia:R,minf:D,moov:S,mvhd:E,stbl:I,stco:V,stsc:A,stsd:T,stss:P,stsz:q,stts:j,tkhd:F,trak:O,udta:L,vmhd:K,ctts:G})[s]?a=new i[s](e,r,n,s):(console.warn("No parser available for %c".concat(s),"text-decoration: underline"),a=new $(e,r,n,s)),t.next=23,a.parse();case 23:return t.abrupt("return",t.sent);case 24:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var b=function(){function t(e,r,n,s){(0,u.Z)(this,t),this.stream=void 0,this.size=void 0,this.type=void 0,this.startOffset=void 0,this.header=void 0,this.stream=e,this.startOffset=r,this.size=n,this.type=s,this.header=this.getHeader()}return(0,c.Z)(t,[{key:"getHeader",value:function(){var t=this.startOffset+this.size;return{size:this.size,type:this.type,startOffset:this.startOffset,endOffset:t}}},{key:"getChildBoxes",value:function(){var t=(0,a.Z)(h().mark((function t(){var e,r;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e={};case 1:if(!(this.stream.offset<this.header.endOffset)){t.next=10;break}return t.next=4,this.getNextChildBox();case 4:"unknown"===(r=t.sent).type&&console.warn("Child box %c".concat(r.header.type,"%c in %c").concat(this.type,"%c is unknown, ignoring."),"text-decoration: underline","text-decoration: none","text-decoration: underline","text-decoration: none"),r.type in e||(e[r.type]=[]),e[r.type].push(r),t.next=1;break;case 10:return t.abrupt("return",e);case 11:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getNextChildBox",value:function(){var t=(0,a.Z)(h().mark((function t(){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g(this.stream);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"seekToEnd",value:function(){if(this.stream.offset!==this.header.endOffset){var t=this.header.endOffset-this.stream.offset;console.warn("Box %c".concat(this.header.type,"%c was not fully parsed! Stopped ").concat(t,"B early."),"text-decoration: underline","text-decoration: none",this.header)}this.stream.seek(this.header.endOffset)}}]),t}(),N=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"parse",value:function(){var t=(0,a.Z)(h().mark((function t(){var e;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.parseBox(this.header);case 2:return e=t.sent,this.seekToEnd(),t.abrupt("return",e);case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),r}(b),U=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"getFullBoxHeader",value:function(){var t=(0,a.Z)(h().mark((function t(){var e,r;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stream.getNextUint8();case 2:return e=t.sent,t.next=5,this.stream.getNextUint8();case 5:return t.t0=t.sent,t.t1=t.t0<<16,t.next=9,this.stream.getNextUint8();case 9:return t.t2=t.sent,t.t3=t.t2<<8,t.t4=t.t1|t.t3,t.next=14,this.stream.getNextUint8();case 14:return t.t5=t.sent,r=t.t4|t.t5,t.abrupt("return",{version:e,flags:r});case 17:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"parse",value:function(){var t=(0,a.Z)(h().mark((function t(){var e,r;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getFullBoxHeader();case 2:return e=t.sent,t.next=5,this.parseBox(this.header,e);case 5:return r=t.sent,this.seekToEnd(),t.abrupt("return",r);case 8:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),r}(b),B=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"parseBox",value:function(){var t=(0,a.Z)(h().mark((function t(e){var r,n,s;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stream.getNextString(4);case 2:return r=t.sent,t.next=5,this.stream.getNextUint32();case 5:n=t.sent,s=[];case 7:if(!(this.stream.offset<e.endOffset)){t.next=15;break}return t.t0=s,t.next=11,this.stream.getNextString(4);case 11:t.t1=t.sent,t.t0.push.call(t.t0,t.t1),t.next=7;break;case 15:return t.abrupt("return",{type:"ftyp",header:e,majorBrand:r,minorVersion:n,compatibleBrands:s});case 16:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(N),C=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"parseBox",value:function(){var t=(0,a.Z)(h().mark((function t(e){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.stream.seek(this.header.endOffset),t.abrupt("return",{type:"mdat",header:e});case 2:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(N),S=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"parseBox",value:function(){var t=(0,a.Z)(h().mark((function t(e){var r;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getChildBoxes();case 2:return r=t.sent,t.abrupt("return",{type:"moov",header:e,mvhd:r.mvhd[0],trak:r.trak});case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(N),E=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"parseBox",value:function(){var t=(0,a.Z)(h().mark((function t(e,r){var n,s,i,a,u,c,o,f,p,d;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(1!==r.version){t.next=2;break}throw new Error("Version 1 not supported");case 2:return t.next=4,this.stream.getNextUint32();case 4:return n=t.sent,t.next=7,this.stream.getNextUint32();case 7:return s=t.sent,t.next=10,this.stream.getNextUint32();case 10:return i=t.sent,t.next=13,this.stream.getNextUint32();case 13:return a=t.sent,t.next=16,this.stream.getNextUint32();case 16:return u=t.sent,t.next=19,this.stream.getNextUint16();case 19:return c=t.sent,t.next=22,this.stream.getNextUint16();case 22:return t.next=24,this.stream.getNextUint32();case 24:return t.next=26,this.stream.getNextUint32();case 26:o=[],f=0;case 28:if(!(f<9)){t.next=37;break}return t.t0=o,t.next=32,this.stream.getNextUint32();case 32:t.t1=t.sent,t.t0.push.call(t.t0,t.t1);case 34:f++,t.next=28;break;case 37:p=0;case 38:if(!(p<6)){t.next=44;break}return t.next=41,this.stream.getNextUint32();case 41:p++,t.next=38;break;case 44:return t.next=46,this.stream.getNextUint32();case 46:return d=t.sent,t.abrupt("return",{header:e,type:"mvhd",fullBoxHeader:r,creationTime:n,modificationTime:s,timescale:i,duration:a,rate:u,volume:c,matrix:o,nextTrackId:d});case 48:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()}]),r}(U),O=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"parseBox",value:function(){var t=(0,a.Z)(h().mark((function t(e){var r;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getChildBoxes();case 2:return r=t.sent,t.abrupt("return",{header:e,type:"trak",tkhd:r.tkhd[0],mdia:r.mdia[0]});case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(N),F=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"parseBox",value:function(){var t=(0,a.Z)(h().mark((function t(e,r){var n,s,i,a,u,c,o,f,p,d,x;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(1!==r.version){t.next=2;break}throw new Error("Version 1 not supported");case 2:return t.next=4,this.stream.getNextUint32();case 4:return n=t.sent,t.next=7,this.stream.getNextUint32();case 7:return s=t.sent,t.next=10,this.stream.getNextUint32();case 10:return i=t.sent,t.next=13,this.stream.getNextUint32();case 13:return t.next=15,this.stream.getNextUint32();case 15:return a=t.sent,t.next=18,this.stream.getNextUint32();case 18:return t.next=20,this.stream.getNextUint32();case 20:return t.next=22,this.stream.getNextUint16();case 22:return u=t.sent,t.next=25,this.stream.getNextUint16();case 25:return c=t.sent,t.next=28,this.stream.getNextUint16();case 28:return o=t.sent,t.next=31,this.stream.getNextUint16();case 31:f=[],p=0;case 33:if(!(p<9)){t.next=42;break}return t.t0=f,t.next=37,this.stream.getNextUint32();case 37:t.t1=t.sent,t.t0.push.call(t.t0,t.t1);case 39:p++,t.next=33;break;case 42:return t.next=44,this.stream.getNextUint32();case 44:return t.t2=t.sent,d=t.t2>>16,t.next=48,this.stream.getNextUint32();case 48:return t.t3=t.sent,x=t.t3>>16,t.abrupt("return",{header:e,type:"tkhd",fullBoxHeader:r,creationTime:n,modificationTime:s,trackId:i,duration:a,layer:u,alternateGroup:c,volume:o,matrix:f,width:d,height:x});case 51:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()}]),r}(U),R=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"parseBox",value:function(){var t=(0,a.Z)(h().mark((function t(e){var r;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getChildBoxes();case 2:return r=t.sent,t.abrupt("return",{header:e,type:"mdia",mdhd:r.mdhd[0],minf:r.minf[0],hdlr:r.hdlr[0]});case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(N),M=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"parseBox",value:function(){var t=(0,a.Z)(h().mark((function t(e,r){var n,s,i,a,u,c,o;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(1!==r.version){t.next=2;break}throw new Error("Version 1 not supported");case 2:return t.next=4,this.stream.getNextUint32();case 4:return n=t.sent,t.next=7,this.stream.getNextUint32();case 7:return s=t.sent,t.next=10,this.stream.getNextUint32();case 10:return i=t.sent,t.next=13,this.stream.getNextUint32();case 13:return a=t.sent,t.next=16,this.stream.getNextUint16();case 16:for(u=t.sent,c="",o=0;o<3;o++)c+=String.fromCharCode(96+(u>>5*(2-o)&31));return t.next=21,this.stream.getNextUint16();case 21:return t.abrupt("return",{header:e,type:"mdhd",fullBoxHeader:r,creationTime:n,modificationTime:s,timescale:i,duration:a,language:c});case 22:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()}]),r}(U),D=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"parseBox",value:function(){var t=(0,a.Z)(h().mark((function t(e){var r;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getChildBoxes();case 2:return r=t.sent,t.abrupt("return",{header:e,type:"minf",vmhd:"vmhd"in r?r.vmhd[0]:void 0,stbl:r.stbl[0],dinf:r.dinf[0]});case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(N),I=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"parseBox",value:function(){var t=(0,a.Z)(h().mark((function t(e){var r,n,s;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getChildBoxes();case 2:return s=t.sent,t.abrupt("return",{header:e,type:"stbl",stco:null===(r=s.stco)||void 0===r?void 0:r[0],co64:null===(n=s.co64)||void 0===n?void 0:n[0],stsc:s.stsc[0],stsd:s.stsd[0],stss:s.stss[0],stsz:s.stsz[0],stts:s.stts[0],ctts:s.ctts?s.ctts[0]:void 0});case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(N),T=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"parseBox",value:function(){var t=(0,a.Z)(h().mark((function t(e,r){var n,s,i,a;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stream.getNextUint32();case 2:n=t.sent,s=[],i=0;case 5:if(!(i<n)){t.next=13;break}return t.next=8,this.getNextChildBox();case 8:a=t.sent,s.push(a);case 10:i++,t.next=5;break;case 13:return t.abrupt("return",{header:e,type:"stsd",fullBoxHeader:r,entries:s});case 14:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()}]),r}(U),z=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"parseBox",value:function(){var t=(0,a.Z)(h().mark((function t(e){var r,n,s,i,a,u,c,o,f,p,d,x;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=0;case 1:if(!(r<6)){t.next=7;break}return t.next=4,this.stream.getNextUint8();case 4:r++,t.next=1;break;case 7:return t.next=9,this.stream.getNextUint16();case 9:n=t.sent,s=0;case 11:if(!(s<2)){t.next=17;break}return t.next=14,this.stream.getNextUint16();case 14:s++,t.next=11;break;case 17:i=0;case 18:if(!(i<3)){t.next=24;break}return t.next=21,this.stream.getNextUint32();case 21:i++,t.next=18;break;case 24:return t.next=26,this.stream.getNextUint16();case 26:return a=t.sent,t.next=29,this.stream.getNextUint16();case 29:return u=t.sent,t.next=32,this.stream.getNextUint32();case 32:return c=t.sent,t.next=35,this.stream.getNextUint32();case 35:return o=t.sent,t.next=38,this.stream.getNextUint32();case 38:return t.next=40,this.stream.getNextUint16();case 40:return f=t.sent,t.next=43,this.stream.getNextString(32);case 43:return p=t.sent,t.next=46,this.stream.getNextUint16();case 46:return d=t.sent,t.next=49,this.stream.getNextUint16();case 49:return t.next=51,this.getNextChildBox();case 51:return x=t.sent,t.abrupt("return",{header:e,type:"avc1",avcC:x,compressorName:p,dataReferenceIndex:n,depth:d,frameCount:f,height:u,horizontalResolution:c,verticalResolution:o,width:a});case 53:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(N),H=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"parseBox",value:function(){var t=(0,a.Z)(h().mark((function t(e){var r,n,s,i,a,u,c,o,f,p,d,x,l,v,m;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stream.getNextUint8();case 2:return r=t.sent,t.next=5,this.stream.getNextUint8();case 5:return n=t.sent,t.next=8,this.stream.getNextUint8();case 8:return s=t.sent,t.next=11,this.stream.getNextUint8();case 11:return i=t.sent,t.next=14,this.stream.getNextUint8();case 14:return t.t0=t.sent,a=3&t.t0,t.next=18,this.stream.getNextUint8();case 18:t.t1=t.sent,u=31&t.t1,c=[],o=0;case 22:if(!(o<u)){t.next=33;break}return t.next=25,this.stream.getNextUint16();case 25:return f=t.sent,t.next=28,this.stream.getNextBytes(f);case 28:p=t.sent,c.push(p);case 30:o++,t.next=22;break;case 33:return t.next=35,this.stream.getNextUint8();case 35:d=t.sent,x=[],l=0;case 38:if(!(l<d)){t.next=49;break}return t.next=41,this.stream.getNextUint16();case 41:return v=t.sent,t.next=44,this.stream.getNextBytes(v);case 44:m=t.sent,x.push(m);case 46:l++,t.next=38;break;case 49:return t.abrupt("return",{header:e,type:"avcC",configurationVersion:r,profileIndication:n,profileCompatibility:s,levelIndication:i,lengthSizeMinusOne:a,sequenceParameterSets:c,pictureParameterSets:x});case 50:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(N),P=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"parseBox",value:function(){var t=(0,a.Z)(h().mark((function t(e,r){var n,s,i;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stream.getNextUint32();case 2:n=t.sent,s=[],i=0;case 5:if(!(i<n)){t.next=14;break}return t.t0=s,t.next=9,this.stream.getNextUint32();case 9:t.t1=t.sent,t.t0.push.call(t.t0,t.t1);case 11:i++,t.next=5;break;case 14:return t.abrupt("return",{header:e,type:"stss",fullBoxHeader:r,sampleNumbers:s});case 15:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()}]),r}(U),V=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"parseBox",value:function(){var t=(0,a.Z)(h().mark((function t(e,r){var n,s,i;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stream.getNextUint32();case 2:n=t.sent,s=[],i=0;case 5:if(!(i<n)){t.next=14;break}return t.t0=s,t.next=9,this.stream.getNextUint32();case 9:t.t1=t.sent,t.t0.push.call(t.t0,t.t1);case 11:i++,t.next=5;break;case 14:return t.abrupt("return",{header:e,type:"stco",fullBoxHeader:r,chunkOffsets:s});case 15:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()}]),r}(U),_=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"parseBox",value:function(){var t=(0,a.Z)(h().mark((function t(e,r){var n,s,i;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stream.getNextUint32();case 2:n=t.sent,s=[],i=0;case 5:if(!(i<n)){t.next=16;break}return t.t0=s,t.t1=Number,t.next=10,this.stream.getNextUint64();case 10:t.t2=t.sent,t.t3=(0,t.t1)(t.t2),t.t0.push.call(t.t0,t.t3);case 13:i++,t.next=5;break;case 16:return t.abrupt("return",{header:e,type:"co64",fullBoxHeader:r,chunkOffsets:s});case 17:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()}]),r}(U),A=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"parseBox",value:function(){var t=(0,a.Z)(h().mark((function t(e,r){var n,s,i;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stream.getNextUint32();case 2:n=t.sent,s=[],i=0;case 5:if(!(i<n)){t.next=21;break}return t.t0=s,t.next=9,this.stream.getNextUint32();case 9:return t.t1=t.sent,t.next=12,this.stream.getNextUint32();case 12:return t.t2=t.sent,t.next=15,this.stream.getNextUint32();case 15:t.t3=t.sent,t.t4={firstChunk:t.t1,samplesPerChunk:t.t2,sampleDescriptionIndex:t.t3},t.t0.push.call(t.t0,t.t4);case 18:i++,t.next=5;break;case 21:return t.abrupt("return",{header:e,type:"stsc",fullBoxHeader:r,entries:s});case 22:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()}]),r}(U),q=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"parseBox",value:function(){var t=(0,a.Z)(h().mark((function t(e,r){var n,s,i;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stream.getNextUint32();case 2:return t.t0=t.sent,n=[t.t0],t.next=6,this.stream.getNextUint32();case 6:if(s=t.sent,0!==n[0]){t.next=19;break}n=[],i=0;case 10:if(!(i<s)){t.next=19;break}return t.t1=n,t.next=14,this.stream.getNextUint32();case 14:t.t2=t.sent,t.t1.push.call(t.t1,t.t2);case 16:i++,t.next=10;break;case 19:return t.abrupt("return",{header:e,type:"stsz",fullBoxHeader:r,sampleSizes:n,sampleCount:s});case 20:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()}]),r}(U),j=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"parseBox",value:function(){var t=(0,a.Z)(h().mark((function t(e,r){var n,s,i;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stream.getNextUint32();case 2:n=t.sent,s=[],i=0;case 5:if(!(i<n)){t.next=18;break}return t.t0=s,t.next=9,this.stream.getNextUint32();case 9:return t.t1=t.sent,t.next=12,this.stream.getNextUint32();case 12:t.t2=t.sent,t.t3={sampleCount:t.t1,sampleDelta:t.t2},t.t0.push.call(t.t0,t.t3);case 15:i++,t.next=5;break;case 18:return t.abrupt("return",{header:e,type:"stts",fullBoxHeader:r,entries:s});case 19:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()}]),r}(U),L=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"parseBox",value:function(){var t=(0,a.Z)(h().mark((function t(e){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getChildBoxes();case 2:return t.abrupt("return",{header:e,type:"udta"});case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(N),W=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"parseBox",value:function(){var t=(0,a.Z)(h().mark((function t(e,r){var n,s,i;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stream.getNextUint32();case 2:return t.next=4,this.stream.getNextString(4);case 4:n=t.sent,s=0;case 6:if(!(s<3)){t.next=12;break}return t.next=9,this.stream.getNextUint32();case 9:s++,t.next=6;break;case 12:return t.next=14,this.stream.getNextString();case 14:return i=t.sent,t.abrupt("return",{header:e,fullBoxHeader:r,type:"hdlr",handlerType:n,name:i});case 16:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()}]),r}(U),K=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"parseBox",value:function(){var t=(0,a.Z)(h().mark((function t(e,r){var n,s;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stream.getNextUint16();case 2:return n=t.sent,t.next=5,this.stream.getNextUint16();case 5:return t.t0=t.sent,t.next=8,this.stream.getNextUint16();case 8:return t.t1=t.sent,t.next=11,this.stream.getNextUint16();case 11:return t.t2=t.sent,s=[t.t0,t.t1,t.t2],t.abrupt("return",{header:e,fullBoxHeader:r,type:"vmhd",graphicsMode:n,opColor:s});case 14:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()}]),r}(U),G=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"parseBox",value:function(){var t=(0,a.Z)(h().mark((function t(e,r){var n,s,i,a;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stream.getNextUint32();case 2:n=t.sent,s=[],i=[],a=0;case 6:if(!(a<n)){t.next=20;break}return t.t0=s,t.next=10,this.stream.getNextUint32();case 10:return t.t1=t.sent,t.t0.push.call(t.t0,t.t1),t.t2=i,t.next=15,this.stream.getNextUint32();case 15:t.t3=t.sent,t.t2.push.call(t.t2,t.t3);case 17:a++,t.next=6;break;case 20:return t.abrupt("return",{header:e,fullBoxHeader:r,type:"ctts",sampleCounts:s,sampleOffsets:i});case 21:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()}]),r}(U),Q=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"parseBox",value:function(){var t=(0,a.Z)(h().mark((function t(e,r){var n,s,i;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stream.getNextUint32();case 2:n=t.sent,s=[],i=0;case 5:if(!(i<n)){t.next=14;break}return t.t0=s,t.next=9,this.getNextChildBox();case 9:t.t1=t.sent,t.t0.push.call(t.t0,t.t1);case 11:i++,t.next=5;break;case 14:return t.abrupt("return",{header:e,fullBoxHeader:r,type:"dref",entries:s});case 15:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()}]),r}(U),J=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"parseBox",value:function(){var t=(0,a.Z)(h().mark((function t(e){var r;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getChildBoxes();case 2:return r=t.sent,t.abrupt("return",{header:e,type:"dinf",dref:r.dref[0]});case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(N),X=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"parseBox",value:function(){var t=(0,a.Z)(h().mark((function t(e,r){var n,s;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n="",s="",1===r.flags){t.next=9;break}return t.next=5,this.stream.getNextString();case 5:return n=t.sent,t.next=8,this.stream.getNextString();case 8:s=t.sent;case 9:return t.abrupt("return",{header:e,fullBoxHeader:r,type:"urn ",name:n,location:s});case 10:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()}]),r}(U),Y=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"parseBox",value:function(){var t=(0,a.Z)(h().mark((function t(e,r){var n;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n="",1===r.flags){t.next=5;break}return t.next=4,this.stream.getNextString();case 4:n=t.sent;case 5:return t.abrupt("return",{header:e,fullBoxHeader:r,type:"url ",location:n});case 6:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()}]),r}(U),$=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"parseBox",value:function(){var t=(0,a.Z)(h().mark((function t(e){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.stream.seek(this.header.endOffset),t.abrupt("return",{header:e,type:"unknown"});case 2:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(N),tt=r(11752),et=r(61120);function rt(t,e){return nt.apply(this,arguments)}function nt(){return(nt=(0,a.Z)(h().mark((function t(e,r){var n;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(n={"url ":ft,"urn ":pt,avc1:ct,avcC:ut,dinf:dt,dref:xt,ftyp:at,hdlr:vt,mdhd:Zt,mdia:Bt,minf:Ut,moov:St,mvhd:Nt,stbl:ht,stco:mt,stsc:wt,stsd:ot,stss:gt,stsz:yt,stts:kt,tkhd:bt,trak:Ct,vmhd:lt}[r.type])||console.warn("No writer available for %c".concat(r.type,", not writing."),"text-decoration: underline"),t.next=5,new n(e).write(r);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var st=function(){function t(e){(0,u.Z)(this,t),this.stream=e}return(0,c.Z)(t,[{key:"write",value:function(){var t=(0,a.Z)(h().mark((function t(e){var r,n,s;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this.stream.offset,t.next=3,this.stream.writeNextUint32(0);case 3:return t.next=5,this.stream.writeNextString(e.type,4);case 5:return t.next=7,this.writeContents(e);case 7:return n=this.stream.offset,s=n-r,t.next=11,this.stream.seek(r);case 11:return t.next=13,this.stream.writeNextUint32(s);case 13:return t.next=15,this.stream.seek(n);case 15:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),t}(),it=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"writeContents",value:function(){var t=(0,a.Z)(h().mark((function t(e){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stream.writeNextUint8(e.fullBoxHeader.version);case 2:return t.next=4,this.stream.writeNextUint8(e.fullBoxHeader.flags>>16);case 4:return t.next=6,this.stream.writeNextUint8(e.fullBoxHeader.flags>>8);case 6:return t.next=8,this.stream.writeNextUint8(e.fullBoxHeader.flags);case 8:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(st),at=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"writeContents",value:function(){var t=(0,a.Z)(h().mark((function t(e){var r,n,s;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stream.writeNextString(e.majorBrand,4);case 2:return t.next=4,this.stream.writeNextUint32(e.minorVersion);case 4:r=(0,v.Z)(e.compatibleBrands),t.prev=5,r.s();case 7:if((n=r.n()).done){t.next=13;break}return s=n.value,t.next=11,this.stream.writeNextString(s,4);case 11:t.next=7;break;case 13:t.next=18;break;case 15:t.prev=15,t.t0=t.catch(5),r.e(t.t0);case 18:return t.prev=18,r.f(),t.finish(18);case 21:case"end":return t.stop()}}),t,this,[[5,15,18,21]])})));return function(e){return t.apply(this,arguments)}}()}]),r}(st),ut=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"writeContents",value:function(){var t=(0,a.Z)(h().mark((function t(e){var r,n,s,i,a,u;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stream.writeNextUint8(e.configurationVersion);case 2:return t.next=4,this.stream.writeNextUint8(e.profileIndication);case 4:return t.next=6,this.stream.writeNextUint8(e.profileCompatibility);case 6:return t.next=8,this.stream.writeNextUint8(e.levelIndication);case 8:return t.next=10,this.stream.writeNextUint8(252|e.lengthSizeMinusOne);case 10:return t.next=12,this.stream.writeNextUint8(224|e.sequenceParameterSets.length);case 12:r=(0,v.Z)(e.sequenceParameterSets),t.prev=13,r.s();case 15:if((n=r.n()).done){t.next=23;break}return s=n.value,t.next=19,this.stream.writeNextUint16(s.byteLength);case 19:return t.next=21,this.stream.writeNextBytes(s);case 21:t.next=15;break;case 23:t.next=28;break;case 25:t.prev=25,t.t0=t.catch(13),r.e(t.t0);case 28:return t.prev=28,r.f(),t.finish(28);case 31:return t.next=33,this.stream.writeNextUint8(e.pictureParameterSets.length);case 33:i=(0,v.Z)(e.pictureParameterSets),t.prev=34,i.s();case 36:if((a=i.n()).done){t.next=44;break}return u=a.value,t.next=40,this.stream.writeNextUint16(u.byteLength);case 40:return t.next=42,this.stream.writeNextBytes(u);case 42:t.next=36;break;case 44:t.next=49;break;case 46:t.prev=46,t.t1=t.catch(34),i.e(t.t1);case 49:return t.prev=49,i.f(),t.finish(49);case 52:case"end":return t.stop()}}),t,this,[[13,25,28,31],[34,46,49,52]])})));return function(e){return t.apply(this,arguments)}}()}]),r}(st),ct=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"writeContents",value:function(){var t=(0,a.Z)(h().mark((function t(e){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stream.skip(6);case 2:return t.next=4,this.stream.writeNextUint16(e.dataReferenceIndex);case 4:return t.next=6,this.stream.skip(16);case 6:return t.next=8,this.stream.writeNextUint16(e.width);case 8:return t.next=10,this.stream.writeNextUint16(e.height);case 10:return t.next=12,this.stream.writeNextUint32(e.horizontalResolution);case 12:return t.next=14,this.stream.writeNextUint32(e.verticalResolution);case 14:return t.next=16,this.stream.skip(4);case 16:return t.next=18,this.stream.writeNextUint16(e.frameCount);case 18:return t.next=20,this.stream.writeNextString(e.compressorName,32);case 20:return t.next=22,this.stream.writeNextUint16(e.depth);case 22:return t.next=24,this.stream.writeNextUint16(65535);case 24:return t.next=26,rt(this.stream,e.avcC);case 26:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(st),ot=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"writeContents",value:function(){var t=(0,a.Z)(h().mark((function t(e){var n,s,i;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,tt.Z)((0,et.Z)(r.prototype),"writeContents",this).call(this,e);case 2:return t.next=4,this.stream.writeNextUint32(e.entries.length);case 4:n=(0,v.Z)(e.entries),t.prev=5,n.s();case 7:if((s=n.n()).done){t.next=13;break}return i=s.value,t.next=11,rt(this.stream,i);case 11:t.next=7;break;case 13:t.next=18;break;case 15:t.prev=15,t.t0=t.catch(5),n.e(t.t0);case 18:return t.prev=18,n.f(),t.finish(18);case 21:case"end":return t.stop()}}),t,this,[[5,15,18,21]])})));return function(e){return t.apply(this,arguments)}}()}]),r}(it),ht=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"writeContents",value:function(){var t=(0,a.Z)(h().mark((function t(e){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.stco||!e.co64){t.next=2;break}throw new Error("stbl box cannot contain both stco and co64");case 2:if(!e.stco){t.next=7;break}return t.next=5,rt(this.stream,e.stco);case 5:t.next=10;break;case 7:if(!e.co64){t.next=10;break}return t.next=10,rt(this.stream,e.co64);case 10:return t.next=12,rt(this.stream,e.stsc);case 12:return t.next=14,rt(this.stream,e.stsd);case 14:return t.next=16,rt(this.stream,e.stss);case 16:return t.next=18,rt(this.stream,e.stsz);case 18:return t.next=20,rt(this.stream,e.stts);case 20:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(st),ft=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"writeContents",value:function(){var t=(0,a.Z)(h().mark((function t(e){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,tt.Z)((0,et.Z)(r.prototype),"writeContents",this).call(this,e);case 2:if(1===e.fullBoxHeader.flags){t.next=5;break}return t.next=5,this.stream.writeNextString(e.location);case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(it),pt=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"writeContents",value:function(){var t=(0,a.Z)(h().mark((function t(e){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,tt.Z)((0,et.Z)(r.prototype),"writeContents",this).call(this,e);case 2:if(1===e.fullBoxHeader.flags){t.next=7;break}return t.next=5,this.stream.writeNextString(e.name);case 5:return t.next=7,this.stream.writeNextString(e.location);case 7:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(it),dt=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"writeContents",value:function(){var t=(0,a.Z)(h().mark((function t(e){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,rt(this.stream,e.dref);case 2:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(st),xt=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"writeContents",value:function(){var t=(0,a.Z)(h().mark((function t(e){var n,s,i;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,tt.Z)((0,et.Z)(r.prototype),"writeContents",this).call(this,e);case 2:return t.next=4,this.stream.writeNextUint32(e.entries.length);case 4:n=(0,v.Z)(e.entries),t.prev=5,n.s();case 7:if((s=n.n()).done){t.next=13;break}return i=s.value,t.next=11,rt(this.stream,i);case 11:t.next=7;break;case 13:t.next=18;break;case 15:t.prev=15,t.t0=t.catch(5),n.e(t.t0);case 18:return t.prev=18,n.f(),t.finish(18);case 21:case"end":return t.stop()}}),t,this,[[5,15,18,21]])})));return function(e){return t.apply(this,arguments)}}()}]),r}(it),lt=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"writeContents",value:function(){var t=(0,a.Z)(h().mark((function t(e){var n,s,i;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,tt.Z)((0,et.Z)(r.prototype),"writeContents",this).call(this,e);case 2:return t.next=4,this.stream.writeNextUint16(e.graphicsMode);case 4:n=(0,v.Z)(e.opColor),t.prev=5,n.s();case 7:if((s=n.n()).done){t.next=13;break}return i=s.value,t.next=11,this.stream.writeNextUint16(i);case 11:t.next=7;break;case 13:t.next=18;break;case 15:t.prev=15,t.t0=t.catch(5),n.e(t.t0);case 18:return t.prev=18,n.f(),t.finish(18);case 21:case"end":return t.stop()}}),t,this,[[5,15,18,21]])})));return function(e){return t.apply(this,arguments)}}()}]),r}(it),vt=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"writeContents",value:function(){var t=(0,a.Z)(h().mark((function t(e){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,tt.Z)((0,et.Z)(r.prototype),"writeContents",this).call(this,e);case 2:return t.next=4,this.stream.skip(4);case 4:return t.next=6,this.stream.writeNextString(e.handlerType,4);case 6:return t.next=8,this.stream.skip(12);case 8:return t.next=10,this.stream.writeNextString(e.name);case 10:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(it),mt=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"writeContents",value:function(){var t=(0,a.Z)(h().mark((function t(e){var n,s,i;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,tt.Z)((0,et.Z)(r.prototype),"writeContents",this).call(this,e);case 2:return t.next=4,this.stream.writeNextUint32(e.chunkOffsets.length);case 4:n=(0,v.Z)(e.chunkOffsets),t.prev=5,n.s();case 7:if((s=n.n()).done){t.next=13;break}return i=s.value,t.next=11,this.stream.writeNextUint32(i);case 11:t.next=7;break;case 13:t.next=18;break;case 15:t.prev=15,t.t0=t.catch(5),n.e(t.t0);case 18:return t.prev=18,n.f(),t.finish(18);case 21:case"end":return t.stop()}}),t,this,[[5,15,18,21]])})));return function(e){return t.apply(this,arguments)}}()}]),r}(it),yt=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"writeContents",value:function(){var t=(0,a.Z)(h().mark((function t(e){var n,s,i;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,tt.Z)((0,et.Z)(r.prototype),"writeContents",this).call(this,e);case 2:return t.next=4,this.stream.writeNextUint32(e.sampleSizes.length>1?0:e.sampleSizes[0]);case 4:return t.next=6,this.stream.writeNextUint32(e.sampleCount);case 6:n=(0,v.Z)(e.sampleSizes),t.prev=7,n.s();case 9:if((s=n.n()).done){t.next=15;break}return i=s.value,t.next=13,this.stream.writeNextUint32(i);case 13:t.next=9;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(7),n.e(t.t0);case 20:return t.prev=20,n.f(),t.finish(20);case 23:case"end":return t.stop()}}),t,this,[[7,17,20,23]])})));return function(e){return t.apply(this,arguments)}}()}]),r}(it),wt=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"writeContents",value:function(){var t=(0,a.Z)(h().mark((function t(e){var n,s,i;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,tt.Z)((0,et.Z)(r.prototype),"writeContents",this).call(this,e);case 2:return t.next=4,this.stream.writeNextUint32(e.entries.length);case 4:n=(0,v.Z)(e.entries),t.prev=5,n.s();case 7:if((s=n.n()).done){t.next=17;break}return i=s.value,t.next=11,this.stream.writeNextUint32(i.firstChunk);case 11:return t.next=13,this.stream.writeNextUint32(i.samplesPerChunk);case 13:return t.next=15,this.stream.writeNextUint32(i.sampleDescriptionIndex);case 15:t.next=7;break;case 17:t.next=22;break;case 19:t.prev=19,t.t0=t.catch(5),n.e(t.t0);case 22:return t.prev=22,n.f(),t.finish(22);case 25:case"end":return t.stop()}}),t,this,[[5,19,22,25]])})));return function(e){return t.apply(this,arguments)}}()}]),r}(it),kt=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"writeContents",value:function(){var t=(0,a.Z)(h().mark((function t(e){var n,s,i;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,tt.Z)((0,et.Z)(r.prototype),"writeContents",this).call(this,e);case 2:return t.next=4,this.stream.writeNextUint32(e.entries.length);case 4:n=(0,v.Z)(e.entries),t.prev=5,n.s();case 7:if((s=n.n()).done){t.next=15;break}return i=s.value,t.next=11,this.stream.writeNextUint32(i.sampleCount);case 11:return t.next=13,this.stream.writeNextUint32(i.sampleDelta);case 13:t.next=7;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(5),n.e(t.t0);case 20:return t.prev=20,n.f(),t.finish(20);case 23:case"end":return t.stop()}}),t,this,[[5,17,20,23]])})));return function(e){return t.apply(this,arguments)}}()}]),r}(it),gt=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"writeContents",value:function(){var t=(0,a.Z)(h().mark((function t(e){var n,s,i;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,tt.Z)((0,et.Z)(r.prototype),"writeContents",this).call(this,e);case 2:return t.next=4,this.stream.writeNextUint32(e.sampleNumbers.length);case 4:n=(0,v.Z)(e.sampleNumbers),t.prev=5,n.s();case 7:if((s=n.n()).done){t.next=13;break}return i=s.value,t.next=11,this.stream.writeNextUint32(i);case 11:t.next=7;break;case 13:t.next=18;break;case 15:t.prev=15,t.t0=t.catch(5),n.e(t.t0);case 18:return t.prev=18,n.f(),t.finish(18);case 21:case"end":return t.stop()}}),t,this,[[5,15,18,21]])})));return function(e){return t.apply(this,arguments)}}()}]),r}(it),Zt=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"writeContents",value:function(){var t=(0,a.Z)(h().mark((function t(e){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,tt.Z)((0,et.Z)(r.prototype),"writeContents",this).call(this,e);case 2:return t.next=4,this.stream.writeNextUint32(e.creationTime);case 4:return t.next=6,this.stream.writeNextUint32(e.modificationTime);case 6:return t.next=8,this.stream.writeNextUint32(e.timescale);case 8:return t.next=10,this.stream.writeNextUint32(e.duration);case 10:return t.next=12,this.stream.writeNextUint16(21956);case 12:return t.next=14,this.stream.skip(2);case 14:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(it),bt=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"writeContents",value:function(){var t=(0,a.Z)(h().mark((function t(e){var n,s,i;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,tt.Z)((0,et.Z)(r.prototype),"writeContents",this).call(this,e);case 2:return t.next=4,this.stream.writeNextUint32(e.creationTime);case 4:return t.next=6,this.stream.writeNextUint32(e.modificationTime);case 6:return t.next=8,this.stream.writeNextUint32(e.trackId);case 8:return t.next=10,this.stream.skip(4);case 10:return t.next=12,this.stream.writeNextUint32(e.duration);case 12:return t.next=14,this.stream.skip(8);case 14:return t.next=16,this.stream.writeNextUint16(e.layer);case 16:return t.next=18,this.stream.writeNextUint16(e.alternateGroup);case 18:return t.next=20,this.stream.writeNextUint16(e.volume);case 20:return t.next=22,this.stream.skip(2);case 22:n=(0,v.Z)(e.matrix),t.prev=23,n.s();case 25:if((s=n.n()).done){t.next=31;break}return i=s.value,t.next=29,this.stream.writeNextUint32(i);case 29:t.next=25;break;case 31:t.next=36;break;case 33:t.prev=33,t.t0=t.catch(23),n.e(t.t0);case 36:return t.prev=36,n.f(),t.finish(36);case 39:return t.next=41,this.stream.writeNextUint32(e.width);case 41:return t.next=43,this.stream.writeNextUint32(e.height);case 43:case"end":return t.stop()}}),t,this,[[23,33,36,39]])})));return function(e){return t.apply(this,arguments)}}()}]),r}(it),Nt=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"writeContents",value:function(){var t=(0,a.Z)(h().mark((function t(e){var n,s,i;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,tt.Z)((0,et.Z)(r.prototype),"writeContents",this).call(this,e);case 2:return t.next=4,this.stream.writeNextUint32(e.creationTime);case 4:return t.next=6,this.stream.writeNextUint32(e.modificationTime);case 6:return t.next=8,this.stream.writeNextUint32(e.timescale);case 8:return t.next=10,this.stream.writeNextUint32(e.duration);case 10:return t.next=12,this.stream.writeNextUint32(e.rate);case 12:return t.next=14,this.stream.writeNextUint16(e.volume);case 14:return t.next=16,this.stream.skip(10);case 16:n=(0,v.Z)(e.matrix),t.prev=17,n.s();case 19:if((s=n.n()).done){t.next=25;break}return i=s.value,t.next=23,this.stream.writeNextUint32(i);case 23:t.next=19;break;case 25:t.next=30;break;case 27:t.prev=27,t.t0=t.catch(17),n.e(t.t0);case 30:return t.prev=30,n.f(),t.finish(30);case 33:return t.next=35,this.stream.skip(24);case 35:return t.next=37,this.stream.writeNextUint32(e.nextTrackId);case 37:case"end":return t.stop()}}),t,this,[[17,27,30,33]])})));return function(e){return t.apply(this,arguments)}}()}]),r}(it),Ut=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"writeContents",value:function(){var t=(0,a.Z)(h().mark((function t(e){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,rt(this.stream,e.vmhd);case 2:return t.next=4,rt(this.stream,e.dinf);case 4:return t.next=6,rt(this.stream,e.stbl);case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(st),Bt=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"writeContents",value:function(){var t=(0,a.Z)(h().mark((function t(e){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,rt(this.stream,e.mdhd);case 2:return t.next=4,rt(this.stream,e.hdlr);case 4:return t.next=6,rt(this.stream,e.minf);case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(st),Ct=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"writeContents",value:function(){var t=(0,a.Z)(h().mark((function t(e){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,rt(this.stream,e.tkhd);case 2:return t.next=4,rt(this.stream,e.mdia);case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(st),St=function(t){(0,f.Z)(r,t);var e=(0,p.Z)(r);function r(){return(0,u.Z)(this,r),e.apply(this,arguments)}return(0,c.Z)(r,[{key:"writeContents",value:function(){var t=(0,a.Z)(h().mark((function t(e){var r,n,s;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,rt(this.stream,e.mvhd);case 2:r=(0,v.Z)(e.trak),t.prev=3,r.s();case 5:if((n=r.n()).done){t.next=11;break}return s=n.value,t.next=9,rt(this.stream,s);case 9:t.next=5;break;case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(3),r.e(t.t0);case 16:return t.prev=16,r.f(),t.finish(16);case 19:case"end":return t.stop()}}),t,this,[[3,13,16,19]])})));return function(e){return t.apply(this,arguments)}}()}]),r}(st),Et=function(){function t(e){(0,u.Z)(this,t),this.stream=e,this.startOffset=0,this.sizeOffset=0,this.opened=!1,this.closed=!1}return(0,c.Z)(t,[{key:"open",value:function(){var t=(0,a.Z)(h().mark((function t(){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.opened){t.next=4;break}throw new Error("already opened");case 4:if(!this.closed){t.next=6;break}throw new Error("already closed");case 6:return this.startOffset=this.stream.offset,t.next=9,this.stream.writeNextUint32(1);case 9:return t.next=11,this.stream.writeNextString("mdat",4);case 11:return this.sizeOffset=this.stream.offset,t.next=14,this.stream.writeNextUint64(0);case 14:this.opened=!0;case 15:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"write",value:function(){var t=(0,a.Z)(h().mark((function t(e){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.opened){t.next=4;break}throw new Error("not opened");case 4:if(!this.closed){t.next=6;break}throw new Error("already closed");case 6:return t.next=8,this.stream.writeNextBytes(e);case 8:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"close",value:function(){var t=(0,a.Z)(h().mark((function t(){var e;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.opened){t.next=4;break}throw new Error("not opened");case 4:if(!this.closed){t.next=6;break}throw new Error("already closed");case 6:return e=this.stream.offset,t.next=9,this.stream.seek(this.sizeOffset);case 9:return t.next=11,this.stream.writeNextUint64(e-this.startOffset);case 11:return t.next=13,this.stream.seek(e);case 13:this.closed=!0;case 14:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"dataStartOffset",get:function(){if(!this.opened)throw new Error("not opened");return this.startOffset+16}}]),t}(),Ot=function(){function t(e){(0,u.Z)(this,t),this.stream=void 0,this.mdat=void 0,this.moov=void 0,this.stream=new y(e)}return(0,c.Z)(t,[{key:"parse",value:function(){var t=(0,a.Z)(h().mark((function t(){var e,r,n;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.parseBox();case 2:if("ftyp"===t.sent.type){t.next=5;break}throw new Error("Expected ftyp box at start of file. Not an MP4?");case 5:if(this.stream.eof){t.next=19;break}return t.next=8,this.parseBox();case 8:n=t.sent,t.t0=n.type,t.next="mdat"===t.t0?12:"moov"===t.t0?14:16;break;case 12:return e=n,t.abrupt("break",17);case 14:return r=n,t.abrupt("break",17);case 16:return t.abrupt("break",17);case 17:t.next=5;break;case 19:if(e&&r){t.next=21;break}throw new Error("Missing mdat or moov box");case 21:this.mdat=e,this.moov=r;case 23:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getSample",value:function(){var t=(0,a.Z)(h().mark((function t(e){var r,n,s,i,a,u,c;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(r=this.moov.trak[0].mdia.minf.stbl,n=r.stsz,s=r.stco?r.stco:r.co64,i=n.sampleSizes[e],a=s.chunkOffsets[0],u=a,c=0;c<e;c++)u+=r.stsz.sampleSizes[c];return this.stream.seek(u),t.next=10,this.stream.getNextBytes(i);case 10:return t.t0=t.sent,t.t1=this.isSampleSync(e),t.abrupt("return",{data:t.t0,sync:t.t1});case 13:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"isSampleSync",value:function(t){return this.moov.trak[0].mdia.minf.stbl.stss.sampleNumbers.includes(t+1)}},{key:"parseBox",value:function(){var t=(0,a.Z)(h().mark((function t(){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g(this.stream);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),t}(),Ft=function(){function t(e){(0,u.Z)(this,t),this.stream=void 0,this.mdat=void 0,this.avcC=void 0,this.sampleCount=0,this.syncSamples=[],this.sampleSizes=[],this.displaySize=void 0,this.frameRate=60,this.stream=new w(e),this.mdat=new Et(this.stream)}return(0,c.Z)(t,[{key:"open",value:function(){var t=(0,a.Z)(h().mark((function t(){var e;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={type:"ftyp",majorBrand:"isom",minorVersion:0,compatibleBrands:["mp41","avc1","isom"]},t.next=3,rt(this.stream,e);case 3:return t.next=5,this.mdat.open();case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"writeSample",value:function(){var t=(0,a.Z)(h().mark((function t(e,r){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.mdat.write(e);case 2:r&&this.syncSamples.push(this.sampleCount+1),this.sampleSizes.push(e instanceof Blob?e.size:e.byteLength),this.sampleCount++;case 5:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()},{key:"setAvcC",value:function(t){var e,r={type:"avcC",configurationVersion:(e=t instanceof ArrayBuffer?new DataView(t):new DataView(t.buffer,t.byteOffset,t.byteLength)).getUint8(0),profileIndication:e.getUint8(1),profileCompatibility:e.getUint8(2),levelIndication:e.getUint8(3),lengthSizeMinusOne:3&e.getUint8(4),sequenceParameterSets:[],pictureParameterSets:[]},n=5,s=31&e.getUint8(n);n+=1;for(var i=[],a=0;a<s;a++){var u=e.getUint16(n);n+=2;var c=new Uint8Array(e.buffer,e.byteOffset+n,u);i.push(c),n+=u}var o=e.getUint8(n);n+=1;for(var h=[],f=0;f<o;f++){var p=e.getUint16(n);n+=2;var d=new Uint8Array(e.buffer,e.byteOffset+n,p);h.push(d),n+=p}r.sequenceParameterSets=i,r.pictureParameterSets=h,this.avcC=r}},{key:"setDisplaySize",value:function(t){this.displaySize={width:t.width,height:t.height}}},{key:"setFramerate",value:function(t){this.frameRate=t}},{key:"close",value:function(){var t=(0,a.Z)(h().mark((function t(){var e;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.mdat.close();case 2:return e={type:"moov",mvhd:this.getMvhdBox(),trak:[this.getTrakBox()]},t.next=5,rt(this.stream,e);case 5:return t.next=7,this.stream.close();case 7:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getTrakBox",value:function(){return{type:"trak",tkhd:this.getTkhdBox(),mdia:this.getMdiaBox()}}},{key:"getTkhdBox",value:function(){var t=k(new Date);return{type:"tkhd",fullBoxHeader:{version:0,flags:3},alternateGroup:0,creationTime:t,duration:Math.floor(1e3*this.sampleCount/this.frameRate),width:this.displaySize.width,height:this.displaySize.height,layer:0,matrix:[65536,0,0,0,65536,0,0,0,1073741824],modificationTime:t,trackId:1,volume:0}}},{key:"getMvhdBox",value:function(){var t=k(new Date);return{type:"mvhd",fullBoxHeader:{version:0,flags:0},duration:Math.floor(1e3*this.sampleCount/this.frameRate),creationTime:t,modificationTime:t,timescale:1e3,rate:65536,volume:256,matrix:[65536,0,0,0,65536,0,0,0,1073741824],nextTrackId:2}}},{key:"getMdiaBox",value:function(){return{type:"mdia",hdlr:{type:"hdlr",fullBoxHeader:{version:0,flags:0},handlerType:"vide",name:"VideoHandler"},minf:this.getMinfBox(),mdhd:this.getMdhdBox()}}},{key:"getMdhdBox",value:function(){var t=k(new Date);return{type:"mdhd",fullBoxHeader:{version:0,flags:0},creationTime:t,duration:this.sampleCount,language:"",modificationTime:t,timescale:this.frameRate}}},{key:"getMinfBox",value:function(){var t=this.getStblBox();return{type:"minf",dinf:this.getDinfBox(),stbl:t,vmhd:{type:"vmhd",fullBoxHeader:{version:0,flags:1},graphicsMode:0,opColor:[0,0,0]}}}},{key:"getDinfBox",value:function(){return{type:"dinf",dref:{type:"dref",fullBoxHeader:{version:0,flags:0},entries:[{type:"url ",fullBoxHeader:{version:0,flags:1},location:""}]}}}},{key:"getStblBox",value:function(){return{type:"stbl",stco:{type:"stco",fullBoxHeader:{version:0,flags:0},chunkOffsets:[this.mdat.dataStartOffset]},stsc:{type:"stsc",fullBoxHeader:{version:0,flags:0},entries:[{firstChunk:1,samplesPerChunk:this.sampleCount,sampleDescriptionIndex:1}]},stsd:{type:"stsd",fullBoxHeader:{version:0,flags:0},entries:[{type:"avc1",dataReferenceIndex:1,width:this.displaySize.width,height:this.displaySize.height,horizontalResolution:4718592,verticalResolution:4718592,frameCount:1,compressorName:"mp4.ts",depth:24,avcC:this.avcC}]},stss:{type:"stss",fullBoxHeader:{version:0,flags:0},sampleNumbers:this.syncSamples},stsz:{type:"stsz",fullBoxHeader:{version:0,flags:0},sampleCount:this.sampleCount,sampleSizes:this.sampleSizes},stts:{type:"stts",fullBoxHeader:{version:0,flags:0},entries:[{sampleCount:this.sampleCount,sampleDelta:1}]}}}}]),t}();function Rt(t){var e=new m.StreamDataView(void 0,!0);e.setNextUint8(t.configurationVersion),e.setNextUint8(t.profileIndication),e.setNextUint8(t.profileCompatibility),e.setNextUint8(t.levelIndication),e.setNextUint8(t.lengthSizeMinusOne+252),e.setNextUint8(t.sequenceParameterSets.length+224);for(var r=0;r<t.sequenceParameterSets.length;r++){e.setNextUint16(t.sequenceParameterSets[r].length);for(var n=0;n<t.sequenceParameterSets[r].length;n++)e.setNextUint8(t.sequenceParameterSets[r][n])}e.setNextUint8(t.pictureParameterSets.length);for(var s=0;s<t.pictureParameterSets.length;s++){e.setNextUint16(t.pictureParameterSets[s].length);for(var i=0;i<t.pictureParameterSets[s].length;i++)e.setNextUint8(t.pictureParameterSets[s][i])}return e.getBuffer()}var Mt=function(){function t(e){(0,u.Z)(this,t),this.decoder=void 0,this.encoder=void 0,this.inMp4=void 0,this.outMp4=void 0,this.expectedFrames=0,this.framesDecoded=0,this.framesDecodedMissing=0,this.framesEncoded=0,this.queuedForDecode=0,this.queuedForEncode=0,this.modifyFrame=void 0,this.progressInit=void 0,this.progressUpdate=void 0,this.processResolve=void 0,this.processReject=void 0,this.progressUpdateIntervalHandle=void 0,this.decodedFrames={},this.encodedFrames=[],this.modifyFrame=e.modifyFrame,this.progressInit=e.progressInit,this.progressUpdate=e.progressUpdate,this.sendProgressUpdate=this.sendProgressUpdate.bind(this)}return(0,c.Z)(t,[{key:"open",value:function(){var t=(0,a.Z)(h().mark((function t(e,r){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.reset(),this.inMp4=new Ot(e),t.next=4,this.inMp4.parse();case 4:return this.outMp4=new Ft(r),t.next=7,this.outMp4.open();case 7:return t.abrupt("return",{width:this.inMp4.moov.trak[0].tkhd.width,height:this.inMp4.moov.trak[0].tkhd.height});case 8:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()},{key:"process",value:function(t){var e=this;return new Promise((function(r,n){var s,i;e.processResolve=r,e.processReject=n;try{var a=e.inMp4.moov.trak[0].mdia.minf.stbl.stsd.entries[0],u="avc1."+a.avcC.profileIndication.toString(16).padStart(2,"0")+a.avcC.profileCompatibility.toString(16).padStart(2,"0")+a.avcC.levelIndication.toString(16).padStart(2,"0");e.decoder.configure({codec:u,codedWidth:e.inMp4.moov.trak[0].tkhd.width,codedHeight:e.inMp4.moov.trak[0].tkhd.height,description:Rt(e.inMp4.moov.trak[0].mdia.minf.stbl.stsd.entries[0].avcC),optimizeForLatency:!1})}catch(o){throw new x.DecoderConfigureError(o)}try{var c=8*e.inMp4.mdat.header.size*e.inMp4.moov.mvhd.timescale/e.inMp4.moov.mvhd.duration;c=5e6*Math.ceil(c/5e6),e.encoder.configure({bitrate:c,codec:"avc1.42003d",framerate:60,height:t.height,latencyMode:"quality",scalabilityMode:"L1T2",width:t.width})}catch(o){throw new x.EncoderConfigureError(o)}null===(s=e.outMp4)||void 0===s||s.setDisplaySize({width:t.width,height:t.height}),null===(i=e.outMp4)||void 0===i||i.setFramerate(60),e.expectedFrames=e.inMp4.moov.trak[0].mdia.minf.stbl.stsz.sampleCount,e.decodedFrames={},e.progressInit({expectedFrames:e.expectedFrames}),e.progressUpdateIntervalHandle=self.setInterval(e.sendProgressUpdate,100),e.processSamples()}))}},{key:"reset",value:function(){this.encoder&&this.encoder.close(),this.encoder=new VideoEncoder({output:this.handleEncodedFrame.bind(this),error:this.handleEncoderError.bind(this)}),this.decoder&&this.decoder.close(),this.decoder=new VideoDecoder({output:this.handleDecodedFrame.bind(this),error:this.handleDecoderError.bind(this)}),this.expectedFrames=0,this.framesDecoded=0,this.framesDecodedMissing=0,this.framesEncoded=0,this.queuedForDecode=0,this.queuedForEncode=0,this.processResolve=void 0,this.processReject=void 0,this.progressUpdateIntervalHandle&&clearInterval(this.progressUpdateIntervalHandle)}},{key:"processSamples",value:function(){var t=(0,a.Z)(h().mark((function t(){var e,r,n,s,i,a,u,c,o,f,p,d,x,m,y,w,k,g,Z,b,N,U;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=0;case 1:if(!(e<this.expectedFrames)){t.next=53;break}r=[],n=e;case 4:if(!(n<this.expectedFrames)){t.next=14;break}return t.next=7,this.inMp4.getSample(n);case 7:if(s=t.sent,r.push({index:n,data:s.data.buffer,sync:s.sync}),!(n+1<this.expectedFrames&&this.inMp4.isSampleSync(n+1))){t.next=11;break}return t.abrupt("break",14);case 11:n++,t.next=4;break;case 14:for(this.decodedFrames={},i=0,a=r;i<a.length;i++)u=a[i],this.decodedFrames[u.index]={index:u.index,image:void 0,sync:u.sync};for(c=0,o=r;c<o.length;c++)f=o[c],p=new EncodedVideoChunk({type:f.sync?"key":"delta",timestamp:f.index,duration:16670,data:f.data}),this.decoder.decode(p),this.queuedForDecode++;return t.next=19,this.decoder.flush();case 19:d=this.reorderFrames(e),this.encodedFrames=[],x=(0,v.Z)(d.entries()),t.prev=22,x.s();case 24:if((m=x.n()).done){t.next=38;break}if(y=(0,l.Z)(m.value,2),w=y[0],(k=y[1]).image){t.next=30;break}return console.error("Frame ".concat(k.index," was never decoded!")),this.framesDecodedMissing++,t.abrupt("continue",36);case 30:g=this.modifyFrame(k.image,k.index),Z=new VideoFrame(g,{duration:16670,timestamp:k.index}),0===w&&this.progressUpdate({preview:g}),this.encoder.encode(Z,{keyFrame:k.sync}),this.queuedForEncode++,Z.close();case 36:t.next=24;break;case 38:t.next=43;break;case 40:t.prev=40,t.t0=t.catch(22),x.e(t.t0);case 43:return t.prev=43,x.f(),t.finish(43);case 46:return t.next=48,this.encoder.flush();case 48:b=(0,v.Z)(this.encodedFrames);try{for(b.s();!(N=b.n()).done;)U=N.value,this.outMp4.writeSample(U.data,U.sync)}catch(h){b.e(h)}finally{b.f()}e+=r.length,t.next=1;break;case 53:return t.next=55,this.outMp4.close();case 55:this.sendProgressUpdate(),this.processResolve();case 57:case"end":return t.stop()}}),t,this,[[22,40,43,46]])})));return function(){return t.apply(this,arguments)}}()},{key:"reorderFrames",value:function(t){var e=[],r=this.inMp4.moov.trak[0].mdia.minf.stbl.ctts;if(r)for(var n=this.inMp4.moov.trak[0].mdia.minf.stbl.stts.entries[0].sampleDelta,s=r.sampleOffsets[0]/n,i=0;i<Object.keys(this.decodedFrames).length;i++){for(var a=t+i,u=0,c=0;a>=c;)u++,c=r.sampleCounts.slice(0,u).reduce((function(t,e){return t+e}),0);var o=i+r.sampleOffsets[u-1]/n-s;e[o]=Object.assign({},this.decodedFrames[t+i],{index:t+o})}else for(var h=0;h<Object.keys(this.decodedFrames).length;h++)e.push(this.decodedFrames[t+h]);return e}},{key:"handleDecodedFrame",value:function(){var t=(0,a.Z)(h().mark((function t(e){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.framesDecoded++,t.next=3,createImageBitmap(e);case 3:this.decodedFrames[e.timestamp].image=t.sent,e.close();case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"handleEncodedFrame",value:function(t,e){this.framesEncoded++;var r,n=new ArrayBuffer(t.byteLength);(t.copyTo(n),this.encodedFrames.push({data:n,sync:"key"===t.type,timestamp:t.timestamp}),0===t.timestamp)&&this.outMp4.setAvcC(null===(r=e.decoderConfig)||void 0===r?void 0:r.description)}},{key:"handleDecoderError",value:function(t){throw this.processReject(new x.DecoderError(t.message)),t}},{key:"handleEncoderError",value:function(t){throw this.processReject(new x.EncoderError(t.message)),t}},{key:"sendProgressUpdate",value:function(){var t,e;this.progressUpdate({framesDecoded:this.framesDecoded,framesDecodedMissing:this.framesDecodedMissing,framesEncoded:this.framesEncoded,queuedForDecode:this.queuedForDecode,queuedForEncode:this.queuedForEncode,inDecoderQueue:null===(t=this.decoder)||void 0===t?void 0:t.decodeQueueSize,inEncoderQueue:null===(e=this.encoder)||void 0===e?void 0:e.encodeQueueSize})}}]),t}(),Dt=function(){function t(e,r){(0,u.Z)(this,t),this.name=void 0,this.tiles=void 0,this.name=e,this.tiles=r}return(0,c.Z)(t,[{key:"getTile",value:function(t){return this.tiles[t]}}],[{key:"fromFile",value:function(){var e=(0,a.Z)(h().mark((function e(r,n,s){var i,u,c,o,f,p,d,x,v,m,y,w,k,g,Z,b,N,U;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,function(){var t=(0,a.Z)(h().mark((function t(e){var r;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e&&e.size>0)){t.next=8;break}return t.t0=e.name,t.next=4,e.arrayBuffer();case 4:return t.t1=t.sent,t.abrupt("return",[t.t0,t.t1]);case 8:return r="font_".concat(s.header.config.fontVariant.toLowerCase()).concat(n?"_hd":"",".png"),t.next=11,fetch("https://raw.githubusercontent.com/fpv-wtf/msp-osd/main/fonts/".concat(r)).then((function(t){return t.arrayBuffer()}));case 11:return t.t2=t.sent,t.abrupt("return",["font_filename",t.t2]);case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()(r);case 2:return i=e.sent,u=(0,l.Z)(i,2),c=u[0],o=u[1],f=n?24:36,p=n?36:54,e.next=10,createImageBitmap(new Blob([o]));case 10:if(d=e.sent,x=new OffscreenCanvas(d.width,d.height),v=x.getContext("2d")){e.next=15;break}throw new Error("2D context not supported or canvas creation failed");case 15:v.drawImage(d,0,0),m=[],y=256,w=d.width/f,k=0;case 20:if(!(k<w)){e.next=36;break}g=0;case 22:if(!(g<y)){e.next=33;break}return Z=k*f,b=g*p,N=v.getImageData(Z,b,f,p),e.next=28,createImageBitmap(N);case 28:U=e.sent,m.push(U);case 30:g++,e.next=22;break;case 33:k++,e.next=20;break;case 36:return e.abrupt("return",new t(c,m));case 37:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"fromFiles",value:function(){var e=(0,a.Z)(h().mark((function e(r,n){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.fromFile(r.sd,!1,n);case 2:return e.t0=e.sent,e.next=5,t.fromFile(r.hd,!0,n);case 5:return e.t1=e.sent,e.abrupt("return",{sd:e.t0,hd:e.t1});case 7:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}]),t}(),It=function(){function t(e){(0,u.Z)(this,t),this.header=void 0,this.frames=[];var r=new m.StreamDataView(e);if(this.header={magic:r.getNextString(7),version:r.getNextUint16(),config:{charWidth:r.getNextUint8(),charHeight:r.getNextUint8(),fontWidth:r.getNextUint8(),fontHeight:r.getNextUint8(),xOffset:r.getNextUint16(),yOffset:r.getNextUint16(),fontVariant:r.getNextString(5).substring(0,4)}},1===this.header.version)switch(r.resetOffset(),{magic:r.getNextString(7),version:r.getNextUint16(),config:{charWidth:r.getNextUint8(),charHeight:r.getNextUint8(),fontWidth:r.getNextUint8(),fontHeight:r.getNextUint8(),xOffset:r.getNextUint16(),yOffset:r.getNextUint16(),fontVariant:r.getNextUint8()}}.config.fontVariant){case 1:this.header.config.fontVariant="BTFL";break;case 2:this.header.config.fontVariant="INAV";break;case 3:this.header.config.fontVariant="ARDU";break;case 4:this.header.config.fontVariant="ULTR";break;case 5:this.header.config.fontVariant="QUIC";break;default:this.header.config.fontVariant=""}for(31===this.header.config.charWidth&&(this.header.config.charWidth=30);r.getOffset()<e.byteLength;)try{var n=r.getNextUint32(),s=r.getNextUint32(),i=new Uint16Array(e,r.getOffset(),s);r.setOffset(r.getOffset()+2*s),this.frames.push({frameNumber:n,frameSize:s,frameData:i})}catch(a){if(a instanceof RangeError){console.warn("No more data in OSD file, probably truncated due to power loss");break}}}return(0,c.Z)(t,null,[{key:"fromFile",value:function(){var e=(0,a.Z)(h().mark((function e(r){var n;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.arrayBuffer();case 2:return n=e.sent,e.abrupt("return",new t(n));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),t}(),Tt=function(){function t(e){(0,u.Z)(this,t),this.frames=[];var r,n=e.split("\n\n").slice(0,-1),s=(0,v.Z)(n);try{for(s.s();!(r=s.n()).done;){var i=r.value.split("\n"),a=(0,l.Z)(i,3),c=a[1],o=a[2],h=c.substring(0,12).split(/\D/).map((function(t){return parseInt(t)})),f=(0,l.Z)(h,4),p=f[0],d=f[1],x=f[2],m=f[3],y=c.substring(17).split(/\D/).map((function(t){return parseInt(t)})),w=(0,l.Z)(y,4),k=w[0],g=w[1],Z=w[2],b=w[3],N=1e3*p*60*60+1e3*d*60+1e3*x+m,U=1e3*k*60*60+1e3*g*60+1e3*Z+b,B=o.split(" "),C=(0,l.Z)(B,10),S=C[0],E=C[1],O=C[2],F=C[3],R=C[4],M=C[5],D=C[6],I=C[7],T=C[8],z=C[9],H=S.split(":")[1],P=E.split(":")[1],V=parseInt(O.split(":")[1]),_=F.split(":")[1],A=R.split(":")[1],q=M.split(":")[1],j=D.split(":")[1],L=I.split(":")[1],W=T.split(":")[1],K=z.split(":")[1];this.frames.push({start:N,end:U,signal:H,ch:"CH"+P,flightTime:function(t){var e=String(Math.floor(t/60)).padStart(2,"0"),r=String(t%60).padStart(2,"0");return"".concat(e,"' ").concat(r,'"')}(V),uavBat:_,glsBat:A,uavBatCells:q,glsBatCells:j,delay:L,bitrate:W,rcSignal:K})}}catch(G){s.e(G)}finally{s.f()}}return(0,c.Z)(t,null,[{key:"fromFile",value:function(){var e=(0,a.Z)(h().mark((function e(r){var n;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.text();case 2:return n=e.sent,e.abrupt("return",new t(n));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),t}(),zt=function(){function t(){(0,u.Z)(this,t),this.processor=void 0,this.chromaKey=!1,this.chromaKeyColor="#ff00ff",this.fontPack=void 0,this.osdReader=void 0,this.srtReader=void 0,this.lastOsdIndex=0,this.wide=!1,this.hd=!1,this.outWidth=void 0,this.outHeight=void 0,this.osdCanvas=void 0,this.osdCtx=void 0,this.frameCanvas=void 0,this.frameCtx=void 0,this.processor=new Mt({modifyFrame:this.modifyFrame.bind(this),progressInit:this.progressInit.bind(this),progressUpdate:this.progressUpdate.bind(this)}),addEventListener("message",this.onMessage.bind(this))}return(0,c.Z)(t,[{key:"start",value:function(){var t=(0,a.Z)(h().mark((function t(e){var r,n,s,i,a;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.chromaKey=e.chromaKey,this.chromaKeyColor=e.chromaKeyColor,t.next=4,It.fromFile(e.osdFile);case 4:if(this.osdReader=t.sent,!e.srtFile){t.next=9;break}return t.next=8,Tt.fromFile(e.srtFile);case 8:this.srtReader=t.sent;case 9:return t.next=11,Dt.fromFiles(e.fontFiles,this.osdReader);case 11:return this.fontPack=t.sent,t.next=14,this.processor.open(e.videoFile,e.outHandle);case 14:return r=t.sent,n=r.width,s=r.height,1280===n&&720===s&&(this.wide=!0),24===this.osdReader.header.config.fontWidth&&(this.hd=!0),this.wide||this.hd?(i=1280,a=720):(i=n,a=s),this.outWidth=i,this.outHeight=a,this.osdCanvas=new OffscreenCanvas(this.osdReader.header.config.fontWidth*this.osdReader.header.config.charWidth,this.osdReader.header.config.fontHeight*this.osdReader.header.config.charHeight),this.osdCtx=this.osdCanvas.getContext("2d"),this.frameCanvas=new OffscreenCanvas(this.outWidth,this.outHeight),this.frameCtx=this.frameCanvas.getContext("2d"),this.lastOsdIndex=0,t.prev=27,t.next=30,this.processor.process({width:i,height:a});case 30:this.postMessage({type:x.MessageType.COMPLETE}),t.next=37;break;case 33:throw t.prev=33,t.t0=t.catch(27),this.postMessage({type:x.MessageType.ERROR,error:t.t0}),t.t0;case 37:case"end":return t.stop()}}),t,this,[[27,33]])})));return function(e){return t.apply(this,arguments)}}()},{key:"modifyFrame",value:function(t,e){var r,n=this.frameCanvas,s=this.frameCtx,i=this.osdCanvas,a=this.osdCtx;(s.fillStyle=this.chromaKey?this.chromaKeyColor:"black",s.fillRect(0,0,n.width,n.height),a.clearRect(0,0,i.width,i.height),this.chromaKey)||(r=this.hd||this.wide?(this.outWidth-t.width)/2:0,s.drawImage(t,r,0));if(this.lastOsdIndex<this.osdReader.frames.length-1){var u=this.lastOsdIndex+1;e>=this.osdReader.frames[u].frameNumber&&(this.lastOsdIndex=u)}if(this.srtReader){var c=function(t,e,r,n){var s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];t.font="".concat(s?"30px":"26px"," calibri"),t.strokeStyle="#333333",t.lineWidth=4,t.strokeText(e,r,n),t.fillStyle="white",t.fillText(e,r,n)},o=1e3*e/60,h=this.srtReader.frames.find((function(t){return t.start<=o&&t.end>o}));o<this.srtReader.frames[0].start?h=this.srtReader.frames[0]:o>this.srtReader.frames[this.srtReader.frames.length-1].end&&(h=this.srtReader.frames[this.srtReader.frames.length-1]),h&&(c(a,h.ch,120,785,!0),c(a,h.delay,1190,710),c(a,h.bitrate,1320,710),c(a,h.uavBat,1060,785,!0),c(a,h.flightTime,1200,785,!0),c(a,h.glsBat,1350,785,!0))}for(var f,p=this.osdReader.frames[this.lastOsdIndex],d=0;d<22;d++)for(var x=0;x<60;x++){var l=d+22*x,v=p.frameData[l],m=void 0;m=this.hd?this.fontPack.hd:this.fontPack.sd,a.drawImage(m.getTile(v),x*this.osdReader.header.config.fontWidth,d*this.osdReader.header.config.fontHeight)}f=n.height/i.height<n.width/i.width?n.height/i.height:n.width/i.width;var y=i.width*f,w=i.height*f,k=(n.width-y)/2,g=(n.height-w)/2;return s.drawImage(i,k,g,y,w),n.transferToImageBitmap()}},{key:"progressInit",value:function(t){this.postMessage((0,i.Z)({type:x.MessageType.PROGRESS_INIT},t))}},{key:"progressUpdate",value:function(t){this.postMessage((0,i.Z)({type:x.MessageType.PROGRESS_UPDATE},t),(0,s.Z)(t.preview?[t.preview]:[]))}},{key:"onMessage",value:function(t){var e=t.data;if(e.type!==x.MessageType.START)throw new Error("Unknown message type received");this.start({chromaKey:e.chromaKey,chromaKeyColor:e.chromaKeyColor,fontFiles:e.fontFiles,osdFile:e.osdFile,srtFile:e.srtFile,outHandle:e.outHandle,videoFile:e.videoFile})}},{key:"postMessage",value:function(t){function e(e,r){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t,e){e?postMessage(t,e):postMessage(t)}))}]),t}();new zt}},e={};function r(n){var s=e[n];if(void 0!==s)return s.exports;var i=e[n]={exports:{}};return t[n].call(i.exports,i,i.exports,r),i.exports}r.m=t,r.x=function(){var t=r.O(void 0,[193],(function(){return r(40906)}));return t=r.O(t)},function(){var t=[];r.O=function(e,n,s,i){if(!n){var a=1/0;for(h=0;h<t.length;h++){n=t[h][0],s=t[h][1],i=t[h][2];for(var u=!0,c=0;c<n.length;c++)(!1&i||a>=i)&&Object.keys(r.O).every((function(t){return r.O[t](n[c])}))?n.splice(c--,1):(u=!1,i<a&&(a=i));if(u){t.splice(h--,1);var o=s();void 0!==o&&(e=o)}}return e}i=i||0;for(var h=t.length;h>0&&t[h-1][2]>i;h--)t[h]=t[h-1];t[h]=[n,s,i]}}(),r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,{a:e}),e},r.d=function(t,e){for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.f={},r.e=function(t){return Promise.all(Object.keys(r.f).reduce((function(e,n){return r.f[n](t,e),e}),[]))},r.u=function(t){return"static/js/"+t+".34d22fc3.chunk.js"},r.miniCssF=function(t){},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/",function(){var t={906:1};r.f.i=function(e,n){t[e]||importScripts(r.p+r.u(e))};var e=self.webpackChunkwtfos_configurator=self.webpackChunkwtfos_configurator||[],n=e.push.bind(e);e.push=function(e){var s=e[0],i=e[1],a=e[2];for(var u in i)r.o(i,u)&&(r.m[u]=i[u]);for(a&&a(r);s.length;)t[s.pop()]=1;n(e)}}(),function(){var t=r.x;r.x=function(){return r.e(193).then(t)}}();r.x()}();
//# sourceMappingURL=906.83c46c06.chunk.js.map